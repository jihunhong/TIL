![enter image description here](https://thinkit.co.jp/sites/default/files/styles/main_image_730x/public/main_images/20150616_491162.jpg?itok=jW9eXv8O)

# ğŸ“– Servlet & JSP ä¸‹

## ğŸ“® [Servlet & JSP ì˜ˆì œ](https://github.com/jihunhong/mysite)
![ìº¡ì²˜](https://i.imgur.com/pwThhzK.png)

### ğŸ“ Example
#### ğŸ”‘ ë¡œê·¸ì¸
1. ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ë©”ë‰´ í´ë¦­
1. ë¸Œë¼ìš°ì €ì—ì„œ `/context/user?a=loginform` request.
1. `userì—` Mapping ë˜ì–´ìˆëŠ” UserServletì˜ doGet() í˜¸ì¶œ
    ```java
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    		String actionName = request.getParameter("a");
    		Action action = new UserActionFactory().getAction(actionName);
    		action.execute(request, response);
    	}
    ```
1. aì˜ ë§¤ê°œë³€ìˆ˜ë¡œ ì“°ì—¬ì§„ loginformì„ actionNameì´ë¼ëŠ” Stringê°ì²´ë¡œ ë°›ì•„
1. UserActionFactoryì—ì„œ í•´ë‹¹í•˜ëŠ” Action ì‹¤í–‰
    ```Java
    else if("login".equals(actionName)) {
          action = new LoginAction();
    }
    ```

1. Emailê³¼ Passwordë¥¼ `<form action="path">`ìœ¼ë¡œ ì „ë‹¬ ë°›ì•„ UserDaoì˜ getë©”ì„œë“œë¥¼ í†µí•´ ì¼ì¹˜í•˜ëŠ” `authUser` ê°ì²´ ìƒì„±
    ``` java
    @Override
    public void execute(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {
      String email = request.getParameter("email");
      String password = request.getParameter("password");

      UserVo authUser = new UserDao().get(email, password);

      if(authUser == null) {
        request.setAttribute("result", "fail");
        WebUtil.forward(request, response, "/WEB-INF/views/user/loginform.jsp");
        return;
      }

    //		ë¡œê·¸ì¸ì²˜ë¦¬
      HttpSession session = request.getSession(true);
      session.setAttribute("authUser", authUser);

      WebUtil.redirect(request, response, request.getContextPath()+"/main");

    }
    ```

1. ì•ì—ì„œ ìƒì„±í•œ `authUser`ë¥¼ sessionì— ì„¸íŒ…í•˜ê³ 
1. ë©”ì¸ í˜ì´ì§€ë¡œ Redirect.

<br>
<br>

#### ğŸ”§ íšŒì› ì •ë³´ìˆ˜ì •
1. ë¡œê·¸ì¸ í›„ **ì„¸ì…˜ì´ ì‚´ì•„ìˆëŠ” ìƒíƒœì—ì„œ** ì‚¬ìš©ìê°€ ì •ë³´ìˆ˜ì • ë§í¬ í´ë¦­
1. ë¸Œë¼ìš°ì €ì—ì„œ `/user?a=updateform` request.
1. `userì—` Mapping ë˜ì–´ìˆëŠ” UserServletì˜ doGet() í˜¸ì¶œ
    ```java
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        String actionName = request.getParameter("a");
        Action action = new UserActionFactory().getAction(actionName);
        action.execute(request, response);
      }
    ```
1. aì˜ ë§¤ê°œë³€ìˆ˜ë¡œ ì“°ì—¬ì§„ loginformì„ actionNameì´ë¼ëŠ” Stringê°ì²´ë¡œ ë°›ì•„
1. UserActionFactoryì—ì„œ í•´ë‹¹í•˜ëŠ” Action ì‹¤í–‰
    ```Java
    }else if("updateform".equals(actionName)) {
    			action = new UpdateformAction();
    }
    ```
1. ë¡œê·¸ì¸ ë˜ì–´ ì €ì¥ìƒíƒœì˜ ì„¸ì…˜ì„ ê°€ì ¸ì˜¤ê³  ë¡œê·¸ì¸ë˜ì–´ìˆëŠ” ì•„ì´ë””ì˜ í‚¤ê°’ ì¶”ì¶œ, í‚¤ê°’ìœ¼ë¡œ ì°¾ì€ **Userë¥¼ authUserì„¸ì…˜ìœ¼ë¡œ ìƒˆë¡œ ì €ì¥**
    ```java
    @Override
    	public void execute(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {
    		// ì ‘ê·¼ì œì–´
    		HttpSession session = request.getSession();
    		if(session == null || session.getAttribute("authUser") == null) {
    			WebUtil.redirect(request, response, request.getContextPath()+"/main");
    			return;
    		}

    		UserVo authUser = (UserVo)session.getAttribute("authUser");

    		if(authUser == null) {
    			WebUtil.redirect(request, response, request.getContextPath());
    			return;
    		}

    		Long userNo = authUser.getNo();
    		UserVo userVo = new UserDao().get(userNo);


    		request.setAttribute("userVo", userVo);

    		session.setAttribute("authUser", authUser);


    		WebUtil.forward(request, response, "/WEB-INF/views/user/updateform.jsp");
    	}
    ```
1. `updateform.jsp` ì—ì„œ `<form action="/?a=update">`ìœ¼ë¡œ ì „ë‹¬ ë°›ì•„ `UserServlet`ì—ì„œ ë‹¤ì‹œ `UpdateAction`ê¹Œì§€ í¼ê°’ ì „ë‹¬

1. UserDao.update(vo)ë¥¼ í†µí•´ update ì¿¼ë¦¬ë¥¼ ì‹¤í–‰ í›„
    > **String sql = "update user set name=?, email=?, password=?, gender=? where no=?";**

1. ë³€ê²½ëœ ë‹‰ë„¤ì„ì´ í‘œì‹œë˜ë„ë¡ ë³€ê²½ëœ Userì •ë³´ë¥¼ ì„¸ì…˜ì— ë‹¤ì‹œ ì‹¤ì–´ ë©”ì¸ í˜ì´ì§€ë¡œ Redirect.

**â— URL ìš”ì²­ -> Servlet -> ActionFactory -> íŒë³„ëœ Action() ì‹¤í–‰ -> `Redirect` OR  `forward`**

## ğŸŒ Session / Request

#### ğŸ“¨ Request

| Method | description  |
|---|---|
| .getParamter(name)  |  nameì— ì €ì¥ë˜ì–´ìˆëŠ” **ë¬¸ìì—´** ë°˜í™˜  |
|.getContextPath()  |  **í”„ë¡œì íŠ¸** Path  |

#### ğŸ“¡ Session
> ì„œë²„ìª½ì— ìƒíƒœ ìœ ì§€ë¥¼ ìœ„í•œ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ”ê²ƒ

| Method | description  |
|---|---|
| .getAttribute(String name)  | nameì— ì €ì¥ë˜ì–´ìˆëŠ” **Object** íƒ€ì…ìœ¼ë¡œ ë°˜í™˜ ì—†ì„ ê²½ìš° NULL  |
|.setAttribute(String key , Object value)  |  nameì¸ ì†ì„±ì— value ì˜¤ë¸Œì íŠ¸ í• ë‹¹  |
| .invalidate()  |  í˜„ì¬ ìƒì„±ëœ ì„¸ì…˜ì„ ì¢…ë£Œ  |

### â†ªï¸ Dispatcher / Redirect

#### ğŸ”— Dispatcher : forward(request, response)
> í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­í•˜ë©´ì„œ ì „ì†¡í•œ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€í•œë‹¤.
(ê°™ì€ requestê°ì²´ë¥¼ ë³´ì¡´í•œ ìƒíƒœë¡œ ì´ë™)

#### ã€½ï¸ Redirect : sendRedirect(url)
> requestê°ì²´ê°€ ì—†ì–´ì§€ë©´ì„œ **ìƒˆë¡œìš´** í˜ì´ì§€ë¡œ ì´ë™í•œë‹¤.

**âœ”ï¸ ë§¤ê°œë³€ìˆ˜ë¡œ ì–´ë–¤ ê°ì²´ê°€ ì˜¬ ìˆ˜ ìˆëŠ”ì§€ ìƒê°í•˜ì**

## ë‹¤ë¥¸ JSP ë¬¸ì„œ ì°¸ì¡°í•˜ê¸°
```html
<jsp:include page="/WEB-INF/views/include/navigation.jsp" />
```
